---
title: 索引
---

# 索引

对于存储的需求，无非就是增删改查，并不复杂。但是，一旦存储的数据很多，那性能就成了要关注的重点。
特别是一些跟存储相关的基础系统，比如 MySQL 数据库、消息中间件 RocketMQ 等。这些系统的实现，都离不开**索引**。

## 索引的需求
### 功能性需求
功能性需求需要考虑的点：
1. 数据可以分为两类：
  - 结构化数据，比如，MySQL 中的数据；
  - 非结构化数据，比如搜索引擎中网页。非结构化数据一般需要做预处理，提取出查询关键词，对关键词构建索引。
2. 数据是静态还是动态：
  - 静态数据，也就是说，不会有数据的增加、删除、更新操作，在构建索引的时，只需要考虑查询效率就可以了。
  - 动态数据，大部分场景下，都是对动态数据构建索引，不仅要考虑到索引的查询效率，在**原始数据更新的同时，
  还需要动态地更新索引**。设计起来更加复杂。
3. 索引的存储：
  - 索引存储在内存中，查询的速度肯定要比在磁盘中高。但是，如果原始数据量很大的情况下，对应的索引可能也会
  很大。内存是有限的，这时就需要考虑存储在磁盘。
  - 一部分存储在内存，一部分存储在磁盘，可以兼顾内存消耗和查询效率。
4. 单值查找还是区间查找：
  - 单值查找，也就是根据查询关键词等于某个值的数据。
  - 区间查找，就是查找关键词处于某个区间值的所有数据。
5. 单关键词查找还是多关键词组合查找：
  - 搜索引擎中构建的索引，既要支持一个关键词的查找，比如“数据结构”，也要支持组合关键词查找，比如
  “数据结构 AND 算法”。
  - 对于多关键词查询，像 MySQL 这种结构化数据的查询需求，可以实现针对多个关键词的组合，建立索引；
  对于像搜索引擎这样的非结构数据的查询需求，可以针对单个关键词构建索引，然后通过集合操作，比如求并集、
  求交集等，计算出多个关键词组合的查询结果。

### 非功能性需求   
  
## B+ 树索引
为了加速数据库中数据的查找速度，常用的处理思路是，对表中数据创建索引。索引是如何实现的？

假设有两个需求：
- 根据某个值查找数据，比如 `select * from user where id=1234`；
- 根据区间值来查找某些数据，比如 `select * from user where id > 1234 and id < 2345`。

上面的语句实现了功能需求，除了功能，对于数据库的性能要考察两个方面：
- 执行效率，我们希望通过索引，查询数据的效率尽可能的高；
- 存储空间，我们希望索引不要消耗太多的内存空间。

## 用数据结构解决问题
- 散列表的查询性能很好，时间复杂度是 `O(1)`。但是，散列表不能支持按照区间快速查找数据。所以，散列表不能满足需求。
- 平衡二叉查找树查询的性能也很高，时间复杂度是 `O(logn)`。而且，对树进行中序遍历，可以得到一个从小到大有序的数据序列，
但这仍然不足以支持按照区间快速查找数据。
- 跳表是在链表之上加上多层索引构成的。它支持快速地插入、查找、删除数据，对应的时间复杂度是 `O(logn)`。并且，跳表也支
持按照区间快速地查找数据。只需要定位到区间起点值对应在链表中的结点，然后从这个结点开始，顺序遍历链表，直到区间终点对
应的结点为止，这期间遍历得到的数据就是满足区间值的数据。

跳表是可以解决这个问题。实际上，数据库索引所用到的数据结构跟跳表非常相似，叫作 B+ 树。不过，它是通过二叉查找树演化过来的，
而非跳表。

## 改造二叉查找树来解决问题